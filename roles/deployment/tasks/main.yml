---
- name: Deployment | Include Distro Variables
  ansible.builtin.include_vars: "{{ ansible_distribution }}.yml"
  tags: always

- name: Deployment | Include Role Variables
  ansible.builtin.include_vars: "../../pre-configure/vars/main.yml"
  tags: always

- name: Deployment
  become: true
  become_user: "{{ custom_user }}"
  block:
    - name: "Verify that required string variables are defined"
      assert:
        that:
          - "{{ docker_var }} is defined"
          - "{{ docker_var }} | length > 0"
          - "{{ docker_var }} != None"
        fail_msg: "{{ docker_var }} needs to be set for the role to work"
        success_msg: "Required variable {{ docker_var }} is defined"
      loop_control:
        loop_var: docker_var
      with_items:
        - "{{ docker_username }}"
        - "{{ docker_pass }}"
    - name: Deployment | Deploying Docker
      ansible.builtin.import_tasks: application/app.yml

  rescue:
    - name: Deployment | Rescue
      ansible.builtin.set_fact:
        task_failed: true
